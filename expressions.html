<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>常用表达 | Nova's Lab</title>
    <style>
        :root { --primary: #4D96FF; --bg: #F0F5FF; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .header { width: 100%; max-width: 500px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .back-btn { text-decoration: none; color: var(--primary); font-weight: bold; }
        .container { width: 100%; max-width: 500px; display: flex; flex-direction: column; gap: 15px; }
        .exp-card {
            background: white; border-radius: 18px; padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); border-left: 6px solid var(--primary);
            cursor: pointer; position: relative;
        }
        .en { font-size: 19px; font-weight: bold; color: #2D3436; margin-bottom: 5px; line-height: 1.3; }
        .zh { font-size: 16px; color: #636E72; }
        .scene { position: absolute; right: 15px; top: 15px; font-size: 10px; background: #E0E8FF; color: var(--primary); padding: 2px 8px; border-radius: 10px; }
        
        /* 底部切换导航 */
        .nav-bar { position: fixed; bottom: 0; width: 100%; max-width: 500px; background: white; display: flex; border-top: 1px solid #EEE; }
        .nav-item { flex: 1; text-align: center; padding: 18px; text-decoration: none; color: #BBB; font-weight: bold; }
        .nav-item.active { color: var(--primary); border-top: 3px solid var(--primary); }
    </style>
</head>
<body>

    <div class="header">
        <a href="../index.html" class="back-btn">⇠ Home</a>
        <h1 id="unit-display" style="font-size: 20px;">Unit Loading...</h1>
        <div style="width: 50px;"></div>
    </div>

    <div class="container" id="exp-list">正在读取数据...</div>

    <div style="height: 80px;"></div>

    <nav class="nav-bar">
        <a href="index.html" class="nav-item">单词浏览</a>
        <a href="#" class="nav-item active">表达练习</a>
    </nav>

    <script>
        // 1. 核心提取逻辑：自动识别当前文件夹名字
        // 假设路径是 /unit1/expressions.html，它会提取出 "unit1"
        const folderName = window.location.pathname.split('/').slice(-2, -1)[0] || 'unit1';

        function speak(text) {
            const url = `https://dict.youdao.com/dictvoice?audio=${encodeURIComponent(text)}&type=2`;
            new Audio(url).play();
        }

        async function init() {
            try {
                // 2. 这里的 ../ 是关键，因为它要去上一级目录找 json
                const response = await fetch('../expressions_data.json');
                const allData = await response.json();
                
                // 3. 直接从 JSON 对象里提取当前单元的数据
                const unitData = allData[folderName];

                if (!unitData) {
                    document.getElementById('exp-list').innerText = "未在 JSON 中找到 " + folderName + " 的数据";
                    return;
                }

                document.getElementById('unit-display').innerText = folderName.toUpperCase();
                
                const list = document.getElementById('exp-list');
                list.innerHTML = '';
                
                unitData.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'exp-card';
                    card.onclick = () => speak(item.en);
                    card.innerHTML = `
                        <div class="scene">${item.scene}</div>
                        <div class="en">${item.en}</div>
                        <div class="zh">${item.zh}</div>
                    `;
                    list.appendChild(card);
                });
            } catch (err) {
                document.getElementById('exp-list').innerText = "读取 JSON 失败，请确认文件路径。";
                console.error(err);
            }
        }

        init();

        // iOS 激活音频
        document.addEventListener('touchstart', () => {
            window.speechSynthesis.speak(new SpeechSynthesisUtterance(""));
        }, { once: true });
    </script>
</body>
</html>
